var Stats=function(){var a=Date.now(),b=a,c=0,e=Infinity,d=0,n=0,g=Infinity,m=0,h=0,q=0,r=document.createElement("div");r.id="stats";r.addEventListener("mousedown",function(a){a.preventDefault();l(++q%2)},!1);r.style.cssText="width:80px;opacity:0.9;cursor:pointer";var k=document.createElement("div");k.id="fps";k.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";r.appendChild(k);var x=document.createElement("div");x.id="fpsText";x.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";x.innerHTML="FPS";k.appendChild(x);var t=document.createElement("div");t.id="fpsGraph";t.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(k.appendChild(t);74>t.children.length;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113";t.appendChild(f)}var u=document.createElement("div");u.id="ms";u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";r.appendChild(u);var z=document.createElement("div");z.id="msText";z.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";z.innerHTML="MS";u.appendChild(z);var v=document.createElement("div");v.id="msGraph";v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(u.appendChild(v);74>v.children.length;)f=document.createElement("span"),f.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(f);var l=function(a){q=a;switch(q){case 0:k.style.display="block";u.style.display="none";break;case 1:k.style.display="none",u.style.display="block"}};return{REVISION:11,domElement:r,setMode:l,begin:function(){a=Date.now()},end:function(){var f=Date.now();c=f-a;e=Math.min(e,c);d=Math.max(d,c);z.textContent=c+" MS ("+e+"-"+d+")";var q=Math.min(30,30-c/200*30);v.appendChild(v.firstChild).style.height=q+"px";h++;f>b+1E3&&(n=Math.round(1E3*h/(f-b)),g=Math.min(g,n),m=Math.max(m,n),x.textContent=n+" FPS ("+g+"-"+m+")",q=Math.min(30,30-n/100*30),t.appendChild(t.firstChild).style.height=q+"px",b=f,h=0);return f},update:function(){a=this.end()}}};THREE.OrbitControls=function(a,b){function c(){return Math.pow(.95,f.zoomSpeed)}function e(a){f.object instanceof THREE.PerspectiveCamera?L/=a:f.object instanceof THREE.OrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom*a)),f.object.updateProjectionMatrix(),M=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)}function d(a){f.object instanceof THREE.PerspectiveCamera?L*=a:f.object instanceof THREE.OrthographicCamera?(f.object.zoom=Math.max(f.minZoom,Math.min(f.maxZoom,f.object.zoom/a)),f.object.updateProjectionMatrix(),M=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),f.enableZoom=!1)}function n(a){if(!1!==f.enabled){a.preventDefault();if(a.button===f.mouseButtons.ORBIT){if(!1===f.enableRotate)return;B.set(a.clientX,a.clientY);p=l.ROTATE}else if(a.button===f.mouseButtons.ZOOM){if(!1===f.enableZoom)return;C.set(a.clientX,a.clientY);p=l.DOLLY}else if(a.button===f.mouseButtons.PAN){if(!1===f.enablePan)return;D.set(a.clientX,a.clientY);p=l.PAN}p!==l.NONE&&(document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",m,!1),document.addEventListener("mouseout",m,!1),f.dispatchEvent(z))}}function g(a){!1!==f.enabled&&(a.preventDefault(),p===l.ROTATE?!1!==f.enableRotate&&(E.set(a.clientX,a.clientY),F.subVectors(E,B),a=f.domElement===document?f.domElement.body:f.domElement,y.theta-=2*Math.PI*F.x/a.clientWidth*f.rotateSpeed,y.phi-=2*Math.PI*F.y/a.clientHeight*f.rotateSpeed,B.copy(E),f.update()):p===l.DOLLY?!1!==f.enableZoom&&(G.set(a.clientX,a.clientY),H.subVectors(G,C),0<H.y?e(c()):0>H.y&&d(c()),C.copy(G),f.update()):p===l.PAN&&!1!==f.enablePan&&(I.set(a.clientX,a.clientY),J.subVectors(I,D),K(J.x,J.y),D.copy(I),f.update()))}function m(a){!1!==f.enabled&&(document.removeEventListener("mousemove",g,!1),document.removeEventListener("mouseup",m,!1),document.removeEventListener("mouseout",m,!1),f.dispatchEvent(v),p=l.NONE)}function h(a){if(!1!==f.enabled&&!1!==f.enableZoom&&p===l.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?d(c()):0>b&&e(c());f.update();f.dispatchEvent(z);f.dispatchEvent(v)}}function q(a){if(!1!==f.enabled&&!1!==f.enableKeys&&!1!==f.enablePan)switch(a.keyCode){case f.keys.UP:K(0,f.keyPanSpeed);f.update();break;case f.keys.BOTTOM:K(0,-f.keyPanSpeed);f.update();break;case f.keys.LEFT:K(f.keyPanSpeed,0);f.update();break;case f.keys.RIGHT:K(-f.keyPanSpeed,0),f.update()}}function r(a){if(!1!==f.enabled){switch(a.touches.length){case 1:if(!1===f.enableRotate)return;B.set(a.touches[0].pageX,a.touches[0].pageY);p=l.TOUCH_ROTATE;break;case 2:if(!1===f.enableZoom)return;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;C.set(0,Math.sqrt(b*b+a*a));p=l.TOUCH_DOLLY;break;case 3:if(!1===f.enablePan)return;D.set(a.touches[0].pageX,a.touches[0].pageY);p=l.TOUCH_PAN;break;default:p=l.NONE}p!==l.NONE&&f.dispatchEvent(z)}}function k(a){if(!1!==f.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===f.enableRotate)break;if(p!==l.TOUCH_ROTATE)break;E.set(a.touches[0].pageX,a.touches[0].pageY);F.subVectors(E,B);var b=f.domElement===document?f.domElement.body:f.domElement;y.theta-=2*Math.PI*F.x/b.clientWidth*f.rotateSpeed;y.phi-=2*Math.PI*F.y/b.clientHeight*f.rotateSpeed;B.copy(E);f.update();break;case 2:if(!1===f.enableZoom)break;if(p!==l.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;G.set(0,Math.sqrt(b*b+a*a));H.subVectors(G,C);0<H.y?d(c()):0>H.y&&e(c());C.copy(G);f.update();break;case 3:if(!1===f.enablePan)break;if(p!==l.TOUCH_PAN)break;I.set(a.touches[0].pageX,a.touches[0].pageY);J.subVectors(I,D);K(J.x,J.y);D.copy(I);f.update();break;default:p=l.NONE}}function x(a){!1!==f.enabled&&(f.dispatchEvent(v),p=l.NONE)}function t(a){a.preventDefault()}this.object=a;this.domElement=void 0!==b?b:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return phi};this.getAzimuthalAngle=function(){return theta};this.reset=function(){f.target.copy(f.target0);f.object.position.copy(f.position0);f.object.zoom=f.zoom0;f.object.updateProjectionMatrix();f.dispatchEvent(u);f.update();p=l.NONE};this.update=function(){var b=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),d=c.clone().inverse(),e=new THREE.Vector3,n=new THREE.Quaternion;return function(){var a=f.object.position;b.copy(a).sub(f.target);b.applyQuaternion(c);w.setFromVector3(b);f.autoRotate&&p===l.NONE&&(y.theta-=2*Math.PI/60/60*f.autoRotateSpeed);w.theta+=y.theta;w.phi+=y.phi;w.theta=Math.max(f.minAzimuthAngle,Math.min(f.maxAzimuthAngle,w.theta));w.phi=Math.max(f.minPolarAngle,Math.min(f.maxPolarAngle,w.phi));w.makeSafe();w.radius*=L;w.radius=Math.max(f.minDistance,Math.min(f.maxDistance,w.radius));f.target.add(N);b.setFromSpherical(w);b.applyQuaternion(d);a.copy(f.target).add(b);f.object.lookAt(f.target);!0===f.enableDamping?(y.theta*=1-f.dampingFactor,y.phi*=1-f.dampingFactor):y.set(0,0,0);L=1;N.set(0,0,0);return M||e.distanceToSquared(f.object.position)>A||8*(1-n.dot(f.object.quaternion))>A?(f.dispatchEvent(u),e.copy(f.object.position),n.copy(f.object.quaternion),M=!1,!0):!1}}();this.dispose=function(){f.domElement.removeEventListener("contextmenu",t,!1);f.domElement.removeEventListener("mousedown",n,!1);f.domElement.removeEventListener("mousewheel",h,!1);f.domElement.removeEventListener("MozMousePixelScroll",h,!1);f.domElement.removeEventListener("touchstart",r,!1);f.domElement.removeEventListener("touchend",x,!1);f.domElement.removeEventListener("touchmove",k,!1);document.removeEventListener("mousemove",g,!1);document.removeEventListener("mouseup",m,!1);document.removeEventListener("mouseout",m,!1);window.removeEventListener("keydown",q,!1)};var f=this,u={type:"change"},z={type:"start"},v={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},p=l.NONE,A=1E-6,w=new THREE.Spherical,y=new THREE.Spherical,L=1,N=new THREE.Vector3,M=!1,B=new THREE.Vector2,E=new THREE.Vector2,F=new THREE.Vector2,D=new THREE.Vector2,I=new THREE.Vector2,J=new THREE.Vector2,C=new THREE.Vector2,G=new THREE.Vector2,H=new THREE.Vector2;this.handleResize=function(){};var O=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,0);a.multiplyScalar(-b);N.add(a)}}(),P=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixColumn(c,1);a.multiplyScalar(b);N.add(a)}}(),K=function(){var a=new THREE.Vector3;return function(b,c){var d=f.domElement===document?f.domElement.body:f.domElement;if(f.object instanceof THREE.PerspectiveCamera){a.copy(f.object.position).sub(f.target);var e=a.length(),e=e*Math.tan(f.object.fov/2*Math.PI/180);O(2*b*e/d.clientHeight,f.object.matrix);P(2*c*e/d.clientHeight,f.object.matrix)}else f.object instanceof THREE.OrthographicCamera?(O(b*(f.object.right-f.object.left)/f.object.zoom/d.clientWidth,f.object.matrix),P(c*(f.object.top-f.object.bottom)/f.object.zoom/d.clientHeight,f.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),f.enablePan=!1)}}();f.domElement.addEventListener("contextmenu",t,!1);f.domElement.addEventListener("mousedown",n,!1);f.domElement.addEventListener("mousewheel",h,!1);f.domElement.addEventListener("MozMousePixelScroll",h,!1);f.domElement.addEventListener("touchstart",r,!1);f.domElement.addEventListener("touchend",x,!1);f.domElement.addEventListener("touchmove",k,!1);window.addEventListener("keydown",q,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.constraint.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=a}}});THREE.FirstPersonControls=function(a,b){function c(a){a.preventDefault()}function e(a,b){return function(){b.apply(a,arguments)}}this.object=a;this.target=new THREE.Vector3(0,0,0);this.domElement=void 0!==b?b:document;this.enabled=!0;this.movementSpeed=1;this.lookSpeed=.005;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseDownY=this.mouseDownX=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.viewHalfY=this.viewHalfX=0;this.domElement!==document&&this.domElement.setAttribute("tabindex",-1);this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)};this.onMouseDown=function(a){this.domElement!==document&&this.domElement.focus();a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!0;this.mouseDownX=a.pageX;this.mouseDownY=a.pageY};this.onMouseUp=function(a){a.preventDefault();a.stopPropagation();if(this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1;this.mouseY=this.mouseX=0};this.onMouseMove=function(a){this.mouseDragOn&&(this.mouseX=a.pageX-this.mouseDownX,this.mouseY=a.pageY-this.mouseDownY)};this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 189:this.movementSpeed*=.95;break;case 187:this.movementSpeed*=1.05}};this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}};this.update=function(a){if(!1!==this.enabled){if(this.heightSpeed){var b=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=a*b*this.heightCoef}else this.autoSpeedFactor=0;b=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(b+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(b);this.moveLeft&&this.object.translateX(-b);this.moveRight&&this.object.translateX(b);this.moveUp&&this.object.translateY(b);this.moveDown&&this.object.translateY(-b);a*=this.lookSpeed;this.activeLook||(a=0);b=1;this.constrainVertical&&(b=Math.PI/(this.verticalMax-this.verticalMin));this.lon+=this.mouseX*a;this.lookVertical&&(this.lat-=this.mouseY*a*b);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(90-this.lat);this.theta=THREE.Math.degToRad(this.lon);this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));a=this.target;b=this.object.position;a.x=b.x+100*Math.sin(this.phi)*Math.cos(this.theta);a.y=b.y+100*Math.cos(this.phi);a.z=b.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(a)}};this.dispose=function(){this.domElement.removeEventListener("contextmenu",c,!1);this.domElement.removeEventListener("mousedown",n,!1);this.domElement.removeEventListener("mousemove",d,!1);this.domElement.removeEventListener("mouseup",g,!1);window.removeEventListener("mouseup",g,!1);window.removeEventListener("keydown",m,!1);window.removeEventListener("keyup",h,!1)};var d=e(this,this.onMouseMove),n=e(this,this.onMouseDown),g=e(this,this.onMouseUp),m=e(this,this.onKeyDown),h=e(this,this.onKeyUp);this.domElement.addEventListener("contextmenu",c,!1);this.domElement.addEventListener("mousemove",d,!1);this.domElement.addEventListener("mousedown",n,!1);this.domElement.addEventListener("mouseup",g,!1);window.addEventListener("mouseup",g,!1);window.addEventListener("keydown",m,!1);window.addEventListener("keyup",h,!1);this.handleResize()};var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0};LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]);this._windowSize=a;this._streamPos=this._pos=0};LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0);this._streamPos=this._pos}};LZMA.OutWindow.prototype.releaseStream=function(){this.flush();this._stream=null};LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream();this._stream=a};LZMA.OutWindow.prototype.init=function(a){a||(this._pos=this._streamPos=0)};LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(0>c&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a;this._pos>=this._windowSize&&this.flush()};LZMA.OutWindow.prototype.getByte=function(a){a=this._pos-a-1;0>a&&(a+=this._windowSize);return this._buffer[a]};LZMA.RangeDecoder=function(){};LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a};LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null};LZMA.RangeDecoder.prototype.init=function(){var a=5;this._code=0;for(this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()};LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b=0,c;a--;)this._range>>>=1,c=this._code-this._range>>>31,this._code-=this._range&c-1,b=b<<1|1-c,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b};LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],e=(this._range>>>11)*c;if((this._code^2147483648)<(e^2147483648))return this._range=e,a[b]+=2048-c>>>5,0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0;this._range-=e;this._code-=e;a[b]-=c>>>5;0===(this._range&4278190080)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return 1};LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024};LZMA.BitTreeDecoder=function(a){this._models=[];this._numBitLevels=a};LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)};LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b=1,c=0,e=0,d;e<this._numBitLevels;++e)d=a.decodeBit(this._models,b),b=b<<1|d,c|=d<<e;return c};LZMA.reverseDecode2=function(a,b,c,e){for(var d=1,n=0,g=0,m;g<e;++g)m=c.decodeBit(a,b+d),d=d<<1|m,n|=m<<g;return n};LZMA.LenDecoder=function(){this._choice=[];this._lowCoder=[];this._midCoder=[];this._highCoder=new LZMA.BitTreeDecoder(8);this._numPosStates=0};LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)};LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()};LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)};LZMA.Decoder2=function(){this._decoders=[]};LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)};LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return b&255};LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c=1,e,d;do if(e=b>>7&1,b<<=1,d=a.decodeBit(this._decoders,(1+e<<8)+c),c=c<<1|d,e!==d){for(;256>c;)c=c<<1|a.decodeBit(this._decoders,c);break}while(256>c);return c&255};LZMA.LiteralDecoder=function(){};LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2};LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()};LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((b&255)>>>8-this._numPrevBits)]};LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow;this._rangeDecoder=new LZMA.RangeDecoder;this._isMatchDecoders=[];this._isRepDecoders=[];this._isRepG0Decoders=[];this._isRepG1Decoders=[];this._isRepG2Decoders=[];this._isRep0LongDecoders=[];this._posSlotDecoder=[];this._posDecoders=[];this._posAlignDecoder=new LZMA.BitTreeDecoder(4);this._lenDecoder=new LZMA.LenDecoder;this._repLenDecoder=new LZMA.LenDecoder;this._literalDecoder=new LZMA.LiteralDecoder;this._dictionarySizeCheck=this._dictionarySize=-1;this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6);this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)};LZMA.Decoder.prototype.setDictionarySize=function(a){if(0>a)return!1;this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096)));return!0};LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var e=1<<c;if(8<a||4<b||4<c)return!1;this._literalDecoder.create(b,a);this._lenDecoder.create(e);this._repLenDecoder.create(e);this._posStateMask=e-1;return!0};LZMA.Decoder.prototype.init=function(){var a=4;this._outWindow.init(!1);LZMA.initBitModels(this._isMatchDecoders,192);LZMA.initBitModels(this._isRep0LongDecoders,192);LZMA.initBitModels(this._isRepDecoders,12);LZMA.initBitModels(this._isRepG0Decoders,12);LZMA.initBitModels(this._isRepG1Decoders,12);LZMA.initBitModels(this._isRepG2Decoders,12);LZMA.initBitModels(this._posDecoders,114);for(this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init();this._repLenDecoder.init();this._posAlignDecoder.init();this._rangeDecoder.init()};LZMA.Decoder.prototype.decode=function(a,b,c){var e=0,d=0,n=0,g=0,m=0,h=0,q=0;this._rangeDecoder.setStream(a);this._outWindow.setStream(b);for(this.init();0>c||h<c;)if(a=h&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(e<<4)+a))q=this._literalDecoder.getDecoder(h++,q),q=7<=e?q.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(d)):q.decodeNormal(this._rangeDecoder),this._outWindow.putByte(q),e=4>e?0:e-(10>e?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,e))q=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,e)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(e<<4)+a)&&(e=7>e?9:11,q=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,e)?b=n:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,e)?b=g:(b=m,m=g),g=n),n=d,d=b),0===q&&(q=2+this._repLenDecoder.decode(this._rangeDecoder,a),e=7>e?8:11);else if(m=g,g=n,n=d,q=2+this._lenDecoder.decode(this._rangeDecoder,a),e=7>e?7:10,a=this._posSlotDecoder[5>=q?q-2:3].decode(this._rangeDecoder),4<=a)if(b=(a>>1)-1,d=(2|a&1)<<b,14>a)d+=LZMA.reverseDecode2(this._posDecoders,d-a-1,this._rangeDecoder,b);else{if(d+=this._rangeDecoder.decodeDirectBits(b-4)<<4,d+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>d){if(-1===d)break;return!1}}else d=a;if(d>=h||d>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(d,q);h+=q;q=this._outWindow.getByte(0)}this._outWindow.flush();this._outWindow.releaseStream();this._rangeDecoder.releaseStream();return!0};LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c;if(5>a.size)return!1;b=a.readByte();c=b%9;b=~~(b/9);if(!this.setLcLpPb(c,b%5,~~(b/5)))return!1;b=a.readByte();b|=a.readByte()<<8;b|=a.readByte()<<16;b+=16777216*a.readByte();return this.setDictionarySize(b)};LZMA.decompress=function(a,b,c,e){var d=new LZMA.Decoder;if(!d.setDecoderProperties(a))throw"Incorrect stream properties";if(!d.decode(b,c,e))throw"Error in data stream";return!0};LZMA.decompressFile=function(a,b){var c=new LZMA.Decoder,e;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";e=a.readByte();e|=a.readByte()<<8;e|=a.readByte()<<16;e+=16777216*a.readByte();a.readByte();a.readByte();a.readByte();a.readByte();if(!c.decode(a,b,e))throw"Error in data stream";return!0};EMPLZMAUncompress=function(a){a=new Uint8Array(a);var b={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};LZMA.decompressFile({data:a,position:0,readByte:function(){return this.data[this.position++]}},b);return(new Uint8Array(b.data)).buffer};THREE.JsonEmpLoader=function(a){"boolean"===typeof a&&(console.warn("THREE.JsonEmpLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.withCredentials=!1};THREE.JsonEmpLoader.prototype={constructor:THREE.JsonEmpLoader,get statusDomElement(){void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div"));console.warn("THREE.JsonEmpLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(a,b,c,e,d,n,g,m){var h=this,q=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(a),r=new THREE.XHRLoader(this.manager);r.setWithCredentials(this.withCredentials);r.load(a,function(a){var g=JSON.parse(a);a=q+"index.lz.js";var r=new THREE.XHRLoader(this.manager);r.setWithCredentials(this.withCredentials);r.setPath(this.path);r.setResponseType("arraybuffer");r.load(a,function(a){var f=0;"undefined"!==typeof g.guid&&(f+=Object.keys(g.guid).length);"undefined"!==typeof g.guidCam&&(f+=Object.keys(g.guidCam).length);var r=1;if("undefined"!==typeof g.guid)for(key in g.guid){if(n&&"function"==typeof n[2])n[2](key,r++,f);var k=g.guid[key],l=k.metadata;if("mesh"==l.type){var p=new Uint8Array(a,k.l0,k.l1);h.convertBufferToJson(k,p,l.useZip);p=h.parse(k,q);b(p,l,key)}else if("camera"==l.type||"walkerCamera"==l.type){"undefined"==typeof l.isAniCamera&&(l.isAniCamera=!1);if("undefined"===typeof l.isAniCamera||0!=l.isAniCamera)p=new Uint8Array(a,k.l0,k.l1),h.convertBufferToJson(k,p,l.useZip);p=h.parseAniCameraNode(k,q);"undefined"!==typeof c&&"function"==typeof c.camera&&c.camera(p,l,key)}else if("skeleton"==l.type){var t=key,p=new Uint8Array(a,k.l0,k.l1);h.convertBufferToJson(k,p,l.useZip);e(k,q,t)}else"undefined"!=typeof k.l0&&"undefined"!=typeof k.l1?(t=key,p=new Uint8Array(a,k.l0,k.l1),h.convertBufferToJson(k,p,l.useZip),e(k,q,t)):(t=key,d(k,q,t))}if("undefined"!==typeof g.guidCam)for(key in g.guidCam){if(n&&"function"==typeof n[2])n[2](key,r++,f);k=g.guidCam[key];void 0!==k.metadata&&"undefined"==typeof k.metadata.isAniCamera&&(k.metadata.isAniCamera=!1);if(void 0===k.metadata||0!=k.metadata.isAniCamera)p=new Uint8Array(a,k.l0,k.l1),h.convertBufferToJson(k,p,l.useZip);l=k.metadata;p=h.parseAniCameraNode(k,q);"undefined"!==typeof c&&"function"==typeof c.camera&&c.camera(p,l,key)}if("undefined"!==typeof g.guid)for(key in g.guid)k=g.guid[key],l=k.metadata,"GROUP"==l.type&&"undefined"!==typeof c&&"function"==typeof c.Group&&c.Group(l,key);"function"==typeof m&&m(g.defaultCam)},n&&"function"==typeof n[1]?n[1]:void 0)},n&&"function"==typeof n[0]?n[0]:void 0,g)},setTexturePath:function(a){this.texturePath=a},convertBufferToJson:function(a,b,c){var e;"undefined"==typeof c||c?(e=0,c=EMPLZMAUncompress(b)):(c=b.buffer,e=b.byteOffset);a.vertices=this._loadBinFileWithBuffer(a.vertices,c,"float",e);a.normals=this._loadBinFileWithBuffer(a.normals,c,"float",e);void 0!==a.uvs&&void 0!==a.uvs[0]&&(a.uvs[0]=this._loadBinFileWithBuffer(a.uvs[0],c,"float",e));void 0!==a.uvs&&void 0!==a.uvs[1]&&(a.uvs[1]=this._loadBinFileWithBuffer(a.uvs[1],c,"float",e));a.faces=this._loadBinFileWithBuffer(a.faces,c,"int32",e);a.skinIndices&&(a.skinIndices=this._loadBinFileWithBuffer(a.skinIndices,c,"int32",e));a.skinWeights&&(a.skinWeights=this._loadBinFileWithBuffer(a.skinWeights,c,"float",e));if("undefined"!==typeof a.animations&&2==a.metadata.aniVersion)for(key in a.animations)for(key2 in a.animations[key].hierarchy)b=a.animations[key].hierarchy[key2],b.keys=this._loadBinFileWithBuffer(b.keys,c,b.keys.type,e);else if("undefined"!==typeof a.animations&&"undefined"==a.animations.version&&"undefined"!=typeof a.animations.tracks)for(keyIdx in a.animations.tracks)b=a.animations.tracks[keyIdx],"vector3"===b.type?b.keys=this._loadBinFileWithBuffer(b.keys,c,"timeVector3",e):"quaternion"===b.type?b.keys=this._loadBinFileWithBuffer(b.keys,c,"timeQuaternion",e):"float"===b.type&&(b.keys=this._loadBinFileWithBuffer(b.keys,c,"timefloat",e))},_loadBinFileWithBuffer:function(a,b,c,e){var d="undefined"==typeof e?0:e;if(void 0!==a&&void 0!==b&&void 0!==a.offset&&void 0!==a.length&&0<a.length){e=[];if("float"==c)return a=new Float32Array(b,a.offset+d,a.length/4);if("int32"===c)return a=new Int32Array(b,a.offset+d,a.length/4);if("timeVector3"===c){b=new Float32Array(b,a.offset+d,a.length/4);for(c=0;c<a.length/4;)d={time:b[c],value:[b[c+1],b[c+2],b[c+3]]},c+=4,e.push(d);return e}if("timeQuaternion"===c){b=new Float32Array(b,a.offset+d,a.length/4);for(c=0;c<a.length/4;)d={time:b[c],value:[b[c+1],b[c+2],b[c+3],b[c+4]]},c+=5,e.push(d);return e}if("timefloat"===c){b=new Float32Array(b,a.offset+d,a.length/4);for(c=0;c<a.length/4;)d={time:b[c],value:b[c+1]},c+=2,e.push(d);return e}if("timeTR"==c){b=new Float32Array(b,a.offset+d,a.length/4);for(c=0;c<a.length/4;)d={time:b[c],pos:[b[c+1],b[c+2],b[c+3]],rot:[b[c+4],b[c+5],b[c+6],b[c+7]]},c+=8,e.push(d);return e}if("timeTRS"==c){b=new Float32Array(b,a.offset+d,a.length/4);for(c=0;c<a.length/4;)d={time:b[c],pos:[b[c+1],b[c+2],b[c+3]],rot:[b[c+4],b[c+5],b[c+6],b[c+7]],scl:[b[c+8],b[c+8],b[c+10]]},c+=11,e.push(d);return e}}},parseAniCameraNode:function(a){var b=[],c=[];void 0!==a.animation&&c.push(a.animation);void 0!==a.animations&&(a.animations.length?c=c.concat(a.animations):c.push(a.animations));if(c)for(a=0;a<c.length;a++){var e=THREE.AnimationClip.parse(c[a]);e&&b.push(e)}return b},parse:function(a,b){var c=new THREE.Geometry,e=void 0!==a.scale?1/a.scale:1;(function(b){var d,e,m,h,q,r,k,x,t,f,u,z,v,l=a.faces;r=a.vertices;var p=a.normals,A=a.colors,w=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&w++;for(d=0;d<w;d++)c.faceVertexUvs[d]=[]}h=0;for(q=r.length;h<q;)d=new THREE.Vector3,d.x=r[h++]*b,d.y=r[h++]*b,d.z=r[h++]*b,c.vertices.push(d);h=0;for(q=l.length;h<q;)if(b=l[h++],t=b&1,m=b&2,d=b&8,k=b&16,f=b&32,r=b&64,b&=128,t){t=new THREE.Face3;t.a=l[h];t.b=l[h+1];t.c=l[h+3];u=new THREE.Face3;u.a=l[h+1];u.b=l[h+2];u.c=l[h+3];h+=4;m&&(m=l[h++],t.materialIndex=m,u.materialIndex=m);m=c.faces.length;if(d)for(d=0;d<w;d++)for(z=a.uvs[d],c.faceVertexUvs[d][m]=[],c.faceVertexUvs[d][m+1]=[],e=0;4>e;e++)x=l[h++],v=z[2*x],x=z[2*x+1],v=new THREE.Vector2(v,x),2!==e&&c.faceVertexUvs[d][m].push(v),0!==e&&c.faceVertexUvs[d][m+1].push(v);k&&(k=3*l[h++],t.normal.set(p[k++],p[k++],p[k]),u.normal.copy(t.normal));if(f)for(d=0;4>d;d++)k=3*l[h++],f=new THREE.Vector3(p[k++],p[k++],p[k]),2!==d&&t.vertexNormals.push(f),0!==d&&u.vertexNormals.push(f);r&&(r=l[h++],r=A[r],t.color.setHex(r),u.color.setHex(r));if(b)for(d=0;4>d;d++)r=l[h++],r=A[r],2!==d&&t.vertexColors.push(new THREE.Color(r)),0!==d&&u.vertexColors.push(new THREE.Color(r));c.faces.push(t);c.faces.push(u)}else{t=new THREE.Face3;t.a=l[h++];t.b=l[h++];t.c=l[h++];m&&(m=l[h++],t.materialIndex=m);m=c.faces.length;if(d)for(d=0;d<w;d++)for(z=a.uvs[d],c.faceVertexUvs[d][m]=[],e=0;3>e;e++)x=l[h++],v=z[2*x],x=z[2*x+1],v=new THREE.Vector2(v,x),c.faceVertexUvs[d][m].push(v);k&&(k=3*l[h++],t.normal.set(p[k++],p[k++],p[k]));if(f)for(d=0;3>d;d++)k=3*l[h++],f=new THREE.Vector3(p[k++],p[k++],p[k]),t.vertexNormals.push(f);r&&(r=l[h++],t.color.setHex(A[r]));if(b)for(d=0;3>d;d++)r=l[h++],t.vertexColors.push(new THREE.Color(A[r]));c.faces.push(t)}})(e);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,g=a.skinWeights.length;e<g;e+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[e],1<b?a.skinWeights[e+1]:0,2<b?a.skinWeights[e+2]:0,3<b?a.skinWeights[e+3]:0));if(a.skinIndices)for(e=0,g=a.skinIndices.length;e<g;e+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[e],1<b?a.skinIndices[e+1]:0,2<b?a.skinIndices[e+2]:0,3<b?a.skinIndices[e+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,e=a.morphTargets.length;d<e;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var m=c.morphTargets[d].vertices,h=a.morphTargets[d].vertices,q=0,r=h.length;q<r;q+=3){var k=new THREE.Vector3;k.x=h[q]*b;k.y=h[q+1]*b;k.z=h[q+2]*b;m.push(k)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JsonEmpLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,m=a.morphColors[0].colors,d=0,e=b.length;d<e;d++)b[d].color.fromArray(m,3*d)})(e);(function(){var b=[],e=[];void 0!==a.animation&&e.push(a.animation);void 0!==a.animations&&(a.animations.length?e=e.concat(a.animations):e.push(a.animations));if(c.bones&&0<c.bones.length)for(var g=0;g<e.length;g++){var m=THREE.AnimationClip.parseAnimation(e[g],c.bones);m&&b.push(m)}c.morphTargets&&(g=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(g));if(e&&!c.bones)for(g=0;g<e.length;g++)(m=THREE.AnimationClip.parse(e[g]))&&b.push(m);0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};e=THREE.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:e}}};var scene3D=[],scene3DFunction=[],debugOutput=!1;EmpSceneItemLoad=function(){};EmpScene=function(){this.name="empscene";this.stats=this.grid=this.scene=this.controls=this.camera=this.container=this.renderer=null;this.sceneBoundingBox=new THREE.Box3;this.sceneBoundingBox.makeEmpty();this.clearColor=3829413;this.clearAlpha=1;this.raycaster=new THREE.Raycaster;this.actived=!1;this.loadFileEnd="";this.autoCamClip=!0;this.sceneHelpers=null;this.showSelectBoxFlag=!0;this.showSkyboxFlag=this.showGridFlag=this.showAxisFlag=!1;this.clock=this.mixer=this.skyboxCamera=this.skyboxMesh=this.skyboxTexture=this.skyboxScene=this.box2Helper=this.box1Helper=null;this.group={};this.cameras={};this.pluginItems={};this.createFunctions=new EmpSceneItemLoad;this.lightHelper=[];this.lightHelper1=[]};EmpScene.prototype={constructor:EmpScene,findObjectByName:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.name==a)return c}return null},findObjectByUUID:function(a){if(!this.scene)return null;for(var b in this.scene.children){var c=this.scene.children[b];if(c.uuid==a)return c}return null},removeObjectByUUID:function(a){var b=this,c=this.findObjectByUUID(a);c&&(this.box1Helper.obj==c&&(c.traverse(function(a){b.removeHelper(a)}),this.box1Helper.visible=!1,this.box2Helper.visible=!1),this.hideCtrl(),c.parent.remove(c),this.lightHelper[a]&&(templtHlpr=this.lightHelper[a],templtHlpr1=this.lightHelper1[a],this.sceneHelpers.remove(templtHlpr),this.sceneHelpers.remove(templtHlpr1),delete this.lightHelper[a],delete this.lightHelper1[a]))},setTransformControl:function(a,b,c){(a=this.findObjectByUUID(a))?(this.addObjCtrl(a),this.setModeType(b),this.setSpaceType(c)):(this.setModeType(b),this.setSpaceType(c),this.hideCtrl())},findPluginItemByUUID:function(a){if(!this.pluginItems)return null;for(var b in this.pluginItems){var c=this.pluginItems[b];if(c.uuid==a)return c}return null},addPluginItem:function(a){return this.findPluginItemByUUID(a.uuid)?(console.log("addPluginItem, uuid already exists",a.uuid),null):this.pluginItems[a.uuid]=a},addObject:function(a){if(this.findObjectByName(a.name))return console.log("addObject, name already exists",a.name),null;this.scene.add(a);return a},addHelper:function(){var a=new THREE.BoxHelper;a.material.depthTest=!1;a.material.transparent=!0;a.material.opacity=.3;a.name="EMPBOX";a.visible=!1;this.sceneHelpers.add(a);this.box1Helper=a;a=new THREE.BoxHelper;a.material.depthTest=!0;a.material.transparent=!1;a.name="EMPBOX2";a.visible=!1;this.sceneHelpers.add(a);this.box2Helper=a;this.skyboxCamera=new THREE.PerspectiveCamera(70,this.container.offsetWidth/this.container.offsetHeight,1,1E5)},showAxis:function(a){this.showAxisFlag=a;for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPAXIS"==a.name&&(a.visible=this.showAxisFlag)},showSelectBox:function(a){if("undefined"!==typeof empSizeObj&&1==empSizeObj.builderMode||1==debugOutput){var b=this.findObjectByName(a);console.log("showSelectBox",a,b);b&&"undefined"!==typeof b?(this.box1Helper.visible=this.showSelectBoxFlag,this.box1Helper.update(b),this.box2Helper.visible=this.showSelectBoxFlag,this.box2Helper.update(b),this.showSelectInfo(b)):(this.box1Helper.visible=!1,this.box2Helper.visible=!1)}},showSelectInfo:function(a){var b=a.material.map?a.material.map.image.currentSrc.split("/"):["image name unknown"];this.selectInfoDiv.innerHTML="\u6a21\u578b\u540d\u79f0: "+a.name+"\x3cbr\x3e\x3cbr\x3e\u8d34\u56fe\u7c7b\u578b: "+a.material.type+"\x3cbr\x3e\x3cbr\x3e\u8d34\u56fe\u540d\u79f0: "+b[b.length-1]+"\x3cbr\x3e\x3cbr\x3e\u6a21\u578b\u9762\u6570: "+a.geometry.faces.length+"\x3cbr\x3e\x3cbr\x3e\u6a21\u578b\u5750\u6807: Vector3( "+a.position.x.toFixed(2)+", "+a.position.y.toFixed(2)+", "+a.position.z.toFixed(2)+" )\x3cbr\x3e\x3cbr\x3e\u6a21\u578buuid: "+a.uuid;this.selectInfoDivVsb?this.selectInfoDiv.style.display="block":this.selectInfoDiv.style.display="none"},gridGround:null,createGround:function(){var a=this.getSceneBoundingBox(),b=a.max.x-a.min.x,c=a.max.z-a.min.z,e=(a.max.x+a.min.x)/2,d=(a.max.z+a.min.z)/2,b=b>c?b:c;this.gridGround&&this.sceneHelpers.remove(this.gridGround);this.gridGround=new THREE.GridHelper(b,b/9);this.gridGround.name="EMPGROUND";this.gridGround.visible=!1;this.gridGround.position.set(e,a.min.y-.1*Math.abs(a.min.y),d);this.sceneHelpers.add(this.gridGround);return this.gridGround},axis:null,createAxisHelper:function(){var a=this.getSceneBoundingBox(),b=a.max.x-a.min.x,c=a.max.y-a.min.y,e=a.max.z-a.min.z,d=(a.max.x+a.min.x)/2,n=(a.max.z+a.min.z)/2;this.axis&&this.sceneHelpers.remove(this.axis);b<c&&(b=c);b<e&&(b=e);this.axis=new THREE.AxisHelper(b);this.axis.name="EMPAXIS";this.axis.material.linewidth=3;this.axis.visible=!1;this.axis.position.set(d,a.min.y-.1*Math.abs(a.min.y),n);this.sceneHelpers.add(this.axis)},showGround:function(a){this.showSelectBoxFlag=this.showGridFlag=2==a?!this.showGridFlag:1==a;this.createGround();this.createAxisHelper();for(var b in this.sceneHelpers.children)a=this.sceneHelpers.children[b],"EMPGROUND"==a.name?a.visible=this.showGridFlag:"EMPAXIS"==a.name&&(a.visible=this.showGridFlag);this.showGridFlag?(this.selectInfoDiv.style.display="block",this.selectInfoDivVsb=!0):(this.selectInfoDiv.style.display="none",this.selectInfoDivVsb=!1);this.showLightHelper(this.showGridFlag)},showLightHelper:function(a){for(var b in this.lightHelper)a?this.sceneHelpers.add(this.lightHelper[b]):this.sceneHelpers.remove(this.lightHelper[b]);for(var c in this.lightHelper1)a?this.sceneHelpers.add(this.lightHelper1[c]):this.sceneHelpers.remove(this.lightHelper1[c]);this.ltShow=a},showSkybox:function(a,b){if(this.showSkyboxFlag=a){var c;c="undefined"!==typeof b?b:"min.empcommon/emp/c_RT.jpg min.empcommon/emp/c_LF.jpg min.empcommon/emp/c_UP.jpg min.empcommon/emp/c_DN.jpg min.empcommon/emp/c_BK.jpg min.empcommon/emp/c_FR.jpg".split(" ");this.skyboxTexture=(new THREE.CubeTextureLoader).load(c);this.skyboxTexture.format=THREE.RGBFormat;this.skyboxTexture.mapping=THREE.CubeReflectionMapping;c=THREE.ShaderLib.cube;c=new THREE.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:c.uniforms,depthWrite:!1,side:THREE.BackSide});c.uniforms.tCube.value=this.skyboxTexture;null==this.skyboxMesh?(this.skyboxMesh=new THREE.Mesh(new THREE.BoxGeometry(1E3,1E3,1E3),c),this.skyboxScene.add(this.skyboxMesh)):this.skyboxMesh.material=c}null!==this.skyboxMesh&&(this.skyboxMesh.visible=this.showSkyboxFlag)},setClearColor:function(a,b){"undefined"!==typeof a&&(this.clearColor=a);"undefined"!==typeof b&&(this.clearAlpha=b);this.renderer.setClearColor(this.clearColor,this.clearAlpha)},setControlType:function(a){void 0==a&&(a="orbit");"orbit"==a?this.controls instanceof THREE.OrbitControls||(null!==this.controls&&this.controls.dispose(),this.controls=new THREE.OrbitControls(this.camera,this.container)):"fly"==a?this.controls instanceof THREE.FlyControls||(null!==this.controls&&this.controls.dispose(),this.controls=new THREE.FlyControls(this.camera,this.container),this.controls.movementSpeed=1E3,this.controls.rollSpeed=Math.PI/24,this.controls.autoForward=!1,this.controls.dragToLook=!1):"trackball"==a?this.controls instanceof THREE.TrackballControls||(null!==this.controls&&this.controls.dispose(),this.controls=new THREE.TrackballControls(this.camera,this.container)):"firstperson"!=a||this.controls instanceof THREE.FirstPersonControls||(null!==this.controls&&this.controls.dispose(),this.controls=new THREE.FirstPersonControls(this.camera,this.container));"undefined"!==typeof empSizeObj&&1==empSizeObj.builderMode&&(this.controls.enabled=!1)},clearScene:function(){this.camera.position.set(500,250,500);this.camera.lookAt(new THREE.Vector3);for(var a=this.scene.children;0<a.length;)this.removeObject(a[0]);this.geometries={};this.materials={};this.textures={};this.scripts={}},removeHelper:function(a){},removeObject:function(a){if(void 0!==a.parent){var b=this;b.hideCtrl();a.traverse(function(a){b.removeHelper(a)});a.parent.remove(a);if(this.lightHelper[a.uuid]){var c=this.lightHelper[a.uuid];this.sceneHelpers.remove(c);c.parent.remove(c);delete c}this.lightHelper1[a.uuid]&&(a=this.lightHelper1[a.uuid],this.sceneHelpers.remove(a),a.parent.remove(a),delete a)}},getElapsedTime:function(){return this.clock?this.clock.getElapsedTime():0},newEmpCamera:function(a,b,c){this.cameras[c]={uuid:c,name:b.name,animations:a,metadata:b};return this.cameras[c]},initScene:function(a,b){function c(a){a.preventDefault();var b=new THREE.Vector2,c=!!a.touches,d;c&&(d=a.touches&&a.touches[0]?a.touches[0]:a.changedTouches[0]);var h=c?d.pageY/EmpGlobalZoom-EmpGlobalTop-a.currentTarget.offsetTop:a.offsetY/EmpGlobalZoom,c=c?d.pageX/EmpGlobalZoom-EmpGlobalLeft-a.currentTarget.offsetLeft:a.offsetX/EmpGlobalZoom,c=c/(a.currentTarget.clientWidth/EmpGlobalZoom),h=h/(a.currentTarget.clientHeight/EmpGlobalZoom);b.x=2*c-1;b.y=1-2*h;e.raycaster.setFromCamera(b,e.camera);b=e.raycaster.intersectObjects(e.scene.children);if(0<b.length){if((b=b[0].object)&&"Mesh"==b.type)if("mouseup"==a.type||"touchend"==a.type){if("function"==typeof scene3DFunction[b.uuid+"_up"])scene3DFunction[b.uuid+"_up"]()}else if("mousedown"==a.type||"touchstart"==a.type){if("function"==typeof scene3DFunction[b.uuid+"_down"])scene3DFunction[b.uuid+"_down"]()}else"dblclick"==a.type&&MsgBuilder("select3DItem:"+b.uuid)}else"dblclick"==a.type&&MsgBuilder("select3DItem:00000")}this.container=document.getElementById(a);if(!this.container)return null;this.clock=new THREE.Clock;this.scene=new THREE.Scene;this.sceneHelpers=new THREE.Scene;this.skyboxScene=new THREE.Scene;this.addHelper();this.loadFileEnd="";this.camera=new THREE.PerspectiveCamera(50,this.container.offsetWidth/this.container.offsetHeight,.1,1E4);this.camera.position.set(500,250,500);this.camera.lookAt(new THREE.Vector3);this.createRender(!0);var e=this;this.mixer||(this.mixer=new THREE.AnimationMixer(this.scene),this.mixer.addEventListener("finished",this.finishedFunc,!1));this.container.addEventListener("mousedown",c,!1);this.container.addEventListener("mouseup",c,!1);this.container.addEventListener("touchstart",c,!1);this.container.addEventListener("touchend",c,!1);("undefined"!==typeof empSizeObj&&1==empSizeObj.builderMode||1==debugOutput)&&this.container.addEventListener("dblclick",c,!1);this.selectInfoDiv=document.createElement("div");this.selectInfoDiv.style.cssText="pointer-events: none; background-color: rgba(0, 0, 0, 0.5); background-size: 100% 100%; background-position: 0% 0%; left: 100%; top: 100%; margin-left: -202px; margin-top: -212px; position: fixed; width: 200px; height: 210px; opacity: 1; z-index: 9999; font-size: 12px; color: rgb(255,255,255);word-break:break-all; padding-left: 3px;padding-top: 3px; display: none";document.body.appendChild(this.selectInfoDiv);this.selectInfoDivVsb=!1},createRender:function(a){a=new THREE.WebGLRenderer({antialias:a,alpha:!0});a.setClearColor(this.clearColor,this.clearAlpha);a.setPixelRatio(window.devicePixelRatio);a.autoClear=!1;a.autoUpdateScene=!1;a.setSize(this.container.offsetWidth,this.container.offsetHeight);this.container.appendChild(a.domElement);this.renderer=a},createStat:function(){var a=new Stats;a.domElement.style.position="absolute";a.domElement.style.top="0px";this.container.appendChild(a.domElement);this.stats=a},getMaterialByObjName:function(a,b){var c=0;"undefined"!==typeof b&&(c=b);var e=this.findObjectByName(a);if(e){if("Mesh"==e.type)return e.material;if("SkinnedMesh"==e.type)return e.material.materials[c]}return null},setMaterialByObjName:function(a,b,c){var e=0;"undefined"!==typeof c&&(e=c);(c=this.findObjectByName(a))?"Mesh"==c.type?c.material=b:"SkinnedMesh"==c.type?c.material.materials[e]&&(c.material.materials[e]=b):console.log("obj not mesh",a):console.log("obj not found",a)},getGroupBoundingBox:function(a){var b=new THREE.Box3;b.makeEmpty();for(var c in this.group[a]){var e=this.group[a][c];if("Mesh"==e.type||"SkinnedMesh"==e.type){var d=new THREE.Box3;d.copy(e.geometry.boundingBox);d.applyMatrix4(e.matrixWorld);b.expandByPoint(d.min);b.expandByPoint(d.max)}}return b},getSceneBoundingBox:function(){this.sceneBoundingBox.makeEmpty();for(var a in this.scene.children){var b=this.scene.children[a];if("Mesh"==b.type||"SkinnedMesh"==b.type){var c=new THREE.Box3;c.copy(b.geometry.boundingBox);c.applyMatrix4(b.matrixWorld);this.sceneBoundingBox.expandByPoint(c.min);this.sceneBoundingBox.expandByPoint(c.max)}}return this.sceneBoundingBox},getBoundingBox:function(a){var b=new THREE.Box3;if(a=this.findObjectByName(a))b.copy(a.geometry.boundingBox),b.applyMatrix4(a.matrixWorld);return b},zoomBestObj:function(a){var b=this.findObjectByName(a);if(b&&("Mesh"==b.type||"SkinnedMesh"==b.type)){var c=new THREE.Box3;c.copy(b.geometry.boundingBox);c.applyMatrix4(b.matrixWorld);b=c.getBoundingSphere();c=this.camera.getWorldDirection();this.controls.target&&this.controls.target.copy(b.center);this.camera.lookAt(b.center);this.camera.up.set(0,1,0);var e=new THREE.Vector3;e.addVectors(b.center,c.multiplyScalar(-1*(2*b.radius+1)));this.camera.position.copy(e);debugOutput&&this.showSelectBox(a)}},setObjectMatrix4:function(a,b,c,e){"undefined"!==typeof a&&(a.position.copy(b),a.scale.copy(c),a.quaternion.setFromEuler(e),a.updateMatrix(),a.updateMatrixWorld(!0),this.showSelectBox(a.name));return this},loadEmpObjs:function(a,b,c,e,d,n){var g=this;if(g.loadFileEnd!=a){g.loadFileEnd=a;e.computNormal=!0;var m=new THREE.JsonEmpLoader,h=[];this.group[b]=h;m.load(a,function(a,b,d){var k=new THREE.Matrix4;b.notOrth||k.set(b.mat_wts[0],b.mat_wts[1],b.mat_wts[2],b.mat_wts[3],b.mat_wts[4],b.mat_wts[5],b.mat_wts[6],b.mat_wts[7],b.mat_wts[8],b.mat_wts[9],b.mat_wts[10],b.mat_wts[11],b.mat_wts[12],b.mat_wts[13],b.mat_wts[14],b.mat_wts[15]);"undefined"!==typeof e&&e.computNormal&&(a.geometry.computeFaceNormals(),a.geometry.computeVertexNormals());mesh1=new THREE.Mesh(a.geometry,a.materials[0]);"undefined"!==typeof b.name?mesh1.name=b.name:"undefined"!==typeof b.meshName&&(mesh1.name=b.meshName);mesh1.visible=b.visible;mesh1.uuid=d;c||(c="");mesh1.name=c+mesh1.name;g.addObject(mesh1)&&(mesh1.applyMatrix(k),mesh1.updateMatrixWorld(!0),a.geometry.computeBoundingBox(),b=new THREE.Box3,b.copy(a.geometry.boundingBox),b.applyMatrix4(mesh1.matrixWorld),isNaN(b.min.x)||isNaN(b.min.y)||isNaN(b.min.z)||isNaN(b.max.x)||isNaN(b.max.y)||isNaN(b.max.z)?console.log("EMP Warnning:",mesh1.name+" Boundingbox is error! "):(g.sceneBoundingBox.expandByPoint(b.min),g.sceneBoundingBox.expandByPoint(b.max)),g.sceneBoundingBox.getBoundingSphere(),g.sceneBoundingBox.center(),h.push(mesh1),"undefined"!==typeof e&&e.autoPlay&&(g.mixer||(g.mixer=new THREE.AnimationMixer(g.scene),g.mixer.addEventListener("finished",g.finishedFunc,!1)),geometry.animations&&g.mixer.clipAction(geometry.animations[0],mesh1).setDuration(30*geometry.animations[0].duration).startAt(0).play()));return mesh1},{camera:function(a,b,c){g.cameras[c]={uuid:c,name:b.name,animations:a,metadata:b};return g.cameras[c]},Group:function(a,b){var c=[];for(key in a.ids){var d=g.findObjectByUUID(a.ids[key]);!d||"Mesh"!=d.type&&"SkinnedMesh"!=d.type||c.push(d)}g.group[a.name]=c}},function(a,b,c){b=m.parse(a,b);if("undefined"!==typeof b&&"undefined"!==typeof a&&"undefined"!==typeof a.metadata&&"undefined"!==typeof a.metadata.type){var d=a.metadata.type;c="undefined"!=typeof c?c:a.metadata.uuid;var e;"function"==typeof g.createFunctions[d]?e=g.createFunctions[d](b,a.metadata,c,g):console.log("no load function",d);g.addObject(e)&&(e.geometry.computeBoundingBox(),a=new THREE.Box3,a.copy(e.geometry.boundingBox),a.applyMatrix4(e.matrixWorld),isNaN(a.min.x)||isNaN(a.min.y)||isNaN(a.min.z)||isNaN(a.max.x)||isNaN(a.max.y)||isNaN(a.max.z)?console.log("EMP Warnning:",e.name+" Boundingbox is error! "):(g.sceneBoundingBox.expandByPoint(a.min),g.sceneBoundingBox.expandByPoint(a.max)),g.sceneBoundingBox.getBoundingSphere(),g.sceneBoundingBox.center(),h.push(e),g.mixer||(g.mixer=new THREE.AnimationMixer(g.scene),g.mixer.addEventListener("finished",g.finishedFunc,!1)),e.geometry.animations&&g.mixer.clipAction(e.geometry.animations[0],e).setDuration(e.geometry.animations[0].duration).startAt(0).play())}},function(a,b,c){if("undefined"!==typeof a&&"undefined"!==typeof a.metadata&&"undefined"!==typeof a.metadata.type)if(b=a.metadata.type,c="undefined"!=typeof c?c:a.metadata.uuid,"function"==typeof g.createFunctions[b])g.createFunctions[b](a.metadata,c,g);else console.log("no load function",b)},n,void 0,function(a){"undefined"!==typeof a&&(a=g.findCameraByUUID(a))&&g._switchCamera(a,.1);"function"==typeof d&&d();if("undefined"!==typeof empSizeObj&&"undefined"!==typeof empSizeObj.builderMode&&1==empSizeObj.builderMode){a=0;for(var b in g.scene.children){var c=g.scene.children[b];"Mesh"!=c.type&&"SkinnedMesh"!=c.type||++a}MsgBuilder("BQI:2:\u52a0\u8f7d\u5b8c\u6210\uff0c\u573a\u666f\u4e2d\u73b0\u6709\u6a21\u578b"+a+"\u4e2a\uff01")}})}},showGroup:function(a,b,c){for(var e in this.group[a]){var d=this.group[a][e];"Mesh"==d.type&&this.showMesh(d,b,c)}},showMesh:function(a,b,c){if("undefined"!=typeof a&&"Mesh"===a.type&&"SkinnedMesh"!=a.type){var e=c;"undefined"==typeof c&&(e=1);c=1==b;2==b&&(c=1==a.visible?!1:!0);if(c){if(1!=a.visible){var d=a.material.opacity;a.material.opacity=0;var n=a.material.transparent;a.material.transparent=!0;a.visible=!0;(new TWEEN.Tween(a.material)).to({opacity:d},e*d).easing(TWEEN.Easing.Linear.None).onComplete(function(b){a.material.transparent=n;a.material.opacity=d}).start()}}else 0!=a.visible&&(d=a.material.opacity,n=a.material.transparent,a.material.transparent=!0,(new TWEEN.Tween(a.material)).to({opacity:0},e*d).easing(TWEEN.Easing.Linear.None).onComplete(function(b){a.material.transparent=n;a.material.opacity=d;a.visible=!1}).start())}},_getAniModels:function(a){var b=[];if("undefined"==typeof a||null==a)for(var c in this.scene.children)a=this.scene.children[c],"Mesh"!=a.type&&"SkinnedMesh"!=a.type||!a.geometry.animations||b.push(a);else(a=this.findObjectByName(a))&&("Mesh"==a.type||"SkinnedMesh"==a.type)&&a.geometry.animations&&b.push(a);return b},resetAniModel:function(a){a=this._getAniModels(a);for(var b in a){var c=a[b];this.mixer.clipAction(c.geometry.animations[0],c).stop()}},pauseAniModel:function(){var a=this._getAniModels(modelName),b;for(b in a){var c=a[b];this.mixer.clipAction(c.geometry.animations[0],c).paused=!0}},replayAniModel:function(){var a=this._getAniModels(modelName),b;for(b in a){var c=a[b];this.mixer.clipAction(c.geometry.animations[0],c).paused=!1}},playAniModel:function(a,b,c,e,d){var n=0;"undefined"!==typeof b&&(n=b);b=!1;"undefined"!=typeof c&&(b=c);a=parseFloat(a);isNaN(a)&&(a=1);e=this._getAniModels(e);c=!1;1==e.length&&(c=!0);for(var g in e){var m=e[g],h=this.mixer.clipAction(m.geometry.animations[0],m);c&&"function"===typeof d&&(h.callbackFunc=d);h.setDuration(30*m.geometry.animations[0].duration*a).startAt(null).setLoop(THREE.LoopRepeat,n).play().clampWhenFinished=b}},finishedFunc:function(a){"undefined"!==typeof a&&a.action&&"function"===typeof a.action.callbackFunc&&a.action.callbackFunc()},resetAniCamera:function(a){for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&this.mixer.clipAction(b.animations[0],this.controls).stop()}},pauseAniCamera:function(a){for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!0)}},replayAniCamera:function(a){for(key in this.cameras){var b=this.cameras[key];b.name==a&&b.animations&&(this.mixer.clipAction(b.animations[0],this.controls).paused=!1)}},playAniCamera:function(a,b,c,e,d){var n=0;"undefined"!==typeof c&&(n=c);b=parseFloat(b);isNaN(b)&&(b=1);c=!1;"undefined"!=typeof e&&(c=e);for(key in this.cameras)if(e=this.cameras[key],e.name==a&&e.animations){var g=this.mixer.clipAction(e.animations[0],this.controls);"function"===typeof d&&(g.callbackFunc=d);g.setDuration(30*e.animations[0].duration*b).startAt(null).setLoop(THREE.LoopRepeat,n).play().clampWhenFinished=c}},playAniCamerasWithLoop:function(a,b){function c(){e.resetAniCamera(a[d]);e.playAniCamera(a[d],b,0,!0);++d;d>=a.length&&(d=0)}var e=this,d=0;this.mixer.addEventListener("finished",c,!1);c()},getCameraNameList:function(){var a=[];for(key in this.cameras)a.push(this.cameras[key].name);return a},findCameraByName:function(a){for(key in this.cameras){var b=this.cameras[key];if(b.name==a)return b}return null},findCameraByUUID:function(a){return this.cameras[a]},_switchCamera:function(a,b,c){if("undefined"!==typeof a){var e=new THREE.Vector3;this.controls.target&&e.copy(this.controls.target);3==a.metadata.camSubType&&"camera"==a.metadata.type?(this.setControlType("orbit"),this.controls.minDistance=a.metadata.MinDistance,this.controls.maxDistance=0==a.metadata.MaxDistance?Infinity:a.metadata.MaxDistance,this.controls.minPolarAngle=a.metadata.MinPolarAngle>=a.metadata.MaxPolarAngle?0:a.metadata.MinPolarAngle,this.controls.maxPolarAngle=a.metadata.MinPolarAngle>=a.metadata.MaxPolarAngle?Math.PI:a.metadata.MaxPolarAngle,this.controls.minAzimuthAngle=a.metadata.MinAzimuthAngle>=a.metadata.MaxAzimuthAngle?-Infinity:a.metadata.MinAzimuthAngle,this.controls.maxAzimuthAngle=a.metadata.MinAzimuthAngle>=a.metadata.MaxAzimuthAngle?Infinity:a.metadata.MaxAzimuthAngle,this.controls.enableDamping=a.metadata.EnableDamping,this.controls.dampingFactor=a.metadata.DampingFactor,this.controls.rotateSpeed=a.metadata.RotateSpeed):(this.setControlType("firstperson"),this.controls.movementSpeed=a.metadata.MoveSpeed,this.controls.lookSpeed=a.metadata.RotSpeed,this.controls.lon=a.metadata.InitLon,this.controls.lat=a.metadata.InitLat,console.log("switich walker cam",a.metadata.name));this.camera.fov=a.metadata.fov;this.camera.near=a.metadata.near;this.camera.far=a.metadata.far;this.autoCamClip=a.metadata.AutoClip;if("undefined"!==typeof a.metadata.isAniCamera&&0==a.metadata.isAniCamera){c=new THREE.Vector3;c.fromArray(a.metadata.campos);"undefined"!=typeof a.metadata.campos&&(new TWEEN.Tween(this.controls.object.position)).to(c,b).easing(TWEEN.Easing.Exponential.InOut).start();c=new THREE.Vector3;"undefined"!=typeof a.metadata.lookat&&c.fromArray(a.metadata.lookat);if("undefined"!=typeof a.metadata.rotObj){var d=this.findObjectByUUID(a.metadata.rotObj);if(d&&"Mesh"==d.type){var n=new THREE.Box3;n.copy(d.geometry.boundingBox);n.applyMatrix4(d.matrixWorld);d=n.getBoundingSphere();c.copy(d.center)}}this.controls.target.copy(e);(new TWEEN.Tween(this.controls.target)).to(c,b).easing(TWEEN.Easing.Exponential.InOut).start()}else this.setControlType("orbit"),this.resetAniCamera(a.name),this.playAniCamera(a.name,c.scale,c.times,c.keep,c.cbFunc);return a}return null},switchCameraByName:function(a,b,c){var e=this.findCameraByName(a);this._switchCamera(e,b,c);e||console.log(a," Not Found!(switchCameraByName)")},switchCameraByUUID:function(a,b){var c=this.findCameraByUUID(a);this._switchCamera(c,b);c||console.log(a," Not Found! (switchCameraByUUID)")},switchToCameraAni:function(a,b,c){this.controls.object.up.copy(new THREE.Vector3(0,1,0));b&&(new TWEEN.Tween(this.controls.object.position)).to(b,c).easing(TWEEN.Easing.Exponential.InOut).start();a&&(new TWEEN.Tween(this.controls.target)).to(a,c).easing(TWEEN.Easing.Exponential.InOut).start()},enable:function(){this.actived=!0;this.reszieScene();this.animate()},disable:function(){this.actived=!1},animate:function(){if(0!=this.actived){var a=this.clock.getDelta();TWEEN.update();this.stats&&this.stats.update();if(this.autoCamClip){var b=this.sceneBoundingBox.getBoundingSphere();if(!isNaN(b.center.x)&&!isNaN(b.center.y)&&!isNaN(b.center.z)&&Infinity!=b.radius){var c=new THREE.Vector3;c.subVectors(this.camera.position,b.center);this.camera.up.set(0,1,0);c=c.length();this.camera.near=Math.max(b.radius/1E3,c-b.radius);this.camera.far=Math.max(b.radius,c+b.radius+1);this.camera.updateProjectionMatrix()}}this.controls&&this.controls.update(a);for(var e in this.pluginItems)this.pluginItems[e].update(a);this.mixer&&this.mixer.update(a);if(this.lightHelper)for(var d in this.lightHelper)this.lightHelper[d].update();if(this.lightHelper1)for(var n in this.lightHelper1)this.lightHelper1[n].update();this.transformCtrl&&this.transformCtrl.update();if(1==empSizeObj.builderMode)for(e in this.sceneHelpers.children)a=this.sceneHelpers.children[e],"EMPLIGHT"==a.name&&(a.visible=a.light.visible,a.update());this.render();requestAnimationFrame(animateGlobal)}},render:function(){this.actived&&(this.scene.updateMatrixWorld(),this.skyboxCamera.rotation.copy(this.camera.rotation),this.renderer.clear(),this.renderer.render(this.skyboxScene,this.skyboxCamera),this.renderer.render(this.scene,this.camera),1==empSizeObj.builderMode&&this.renderer.render(this.sceneHelpers,this.camera))},reszieScene:function(){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight);this.renderer.setPixelRatio(window.devicePixelRatio);this.render()},setSceneSize:function(a,b){this.controls&&"function"===typeof this.controls.handleResize&&this.controls.handleResize();this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.skyboxCamera.aspect=a/b;this.skyboxCamera.updateProjectionMatrix();this.renderer.setSize(a,b);this.renderer.setPixelRatio(window.devicePixelRatio)}};function QueryCamInfo(a){var b="",c=scene3D[a];if(c){var b=b+("\u76f8\u673a\u4f4d\u7f6e:"+c.camera.position.x.toFixed(2)+","+c.camera.position.y.toFixed(2)+","+c.camera.position.z.toFixed(2)),b=b+("\r\n\u76ee\u6807\u4f4d\u7f6e:"+c.controls.target.x.toFixed(2)+","+c.controls.target.y.toFixed(2)+","+c.controls.target.z.toFixed(2)),b=b+("\r\n\u6700\u5c0f\u8ddd\u79bb:"+c.controls.minDistance.toFixed(2)),b=b+("\r\n\u6700\u5927\u8ddd\u79bb:"+c.controls.maxDistance.toFixed(2)),e=new THREE.Vector3;e.subVectors(c.controls.object.position,c.controls.target);b+="\r\n\u5f53\u524d\u8ddd\u79bb:"+e.length().toFixed(2)}console.log("QueryCamInfo",a,b);return b}function ApplyCurCamInfo(a){var b="",c=scene3D[a];c&&(b+="CameraPos:"+c.camera.position.x.toFixed(2)+","+c.camera.position.y.toFixed(2)+","+c.camera.position.z.toFixed(2),b+="||LookAt:"+c.controls.target.x.toFixed(2)+","+c.controls.target.y.toFixed(2)+","+c.controls.target.z.toFixed(2),b+="||RotObj:0-0-0-0");console.log("ApplyCurCamInfo",a,b);return b}function QueryMeshInfo(a){var b="";a=a.split(".");if(2!=a.length)return b;var c=scene3D[a[0]];if(c&&(a=c.findObjectByUUID(a[1]))){var e=a.geometry,b=b+("\u9876\u70b9\u4e2a\u6570:"+e.vertices.length),b=b+("\r\n\u4e09\u89d2\u9762\u4e2a\u6570:"+e.faces.length),b=b+("\r\nUV\u901a\u9053\u6570:"+e.faceVertexUvs.length+"\u5c42"),c=new THREE.Box3;c.copy(e.boundingBox);c.applyMatrix4(a.matrixWorld);e=c.getBoundingSphere();b+="\r\n\u5305\u56f4\u5706\u4e2d\u5fc3\u70b9:"+e.center.x.toFixed(2)+","+e.center.y.toFixed(2)+","+e.center.z.toFixed(2)+", \u534a\u5f84"+e.radius.toFixed(2);b+="\r\n\u5305\u56f4\u76d2:"+c.min.x.toFixed(2)+","+c.min.y.toFixed(2)+","+c.min.z.toFixed(2)+" ~ "+c.max.x.toFixed(2)+","+c.max.y.toFixed(2)+","+c.max.z.toFixed(2);a=a.matrix.elements;b+="\r\n\u77e9\u9635:\r\n  "+a[0].toFixed(4)+","+a[1].toFixed(4)+","+a[2].toFixed(4)+","+a[3].toFixed(4)+",\r\n  "+a[4].toFixed(4)+","+a[5].toFixed(4)+","+a[6].toFixed(4)+","+a[7].toFixed(4)+",\r\n  "+a[8].toFixed(4)+","+a[9].toFixed(4)+","+a[10].toFixed(4)+","+a[11].toFixed(4)+",\r\n  "+a[12].toFixed(4)+","+a[13].toFixed(4)+","+a[14].toFixed(4)+","+a[15].toFixed(4)}return b}function _local_replaceColon(a){return a.replace(/:/g,"%3A")}function EMPLyuQuery(a){var b="QueryInfo:";a=a.split(":");if(3!=a.length)return"";"QueryCamInfo"==a[0]?(b+=a[0]+":",b+=_local_replaceColon(QueryCamInfo(a[1])),b+=":"+a[2]):"QueryMeshInfo"==a[0]?(b+=a[0]+":",b+=_local_replaceColon(QueryMeshInfo(a[1])),b+=":"+a[2]):"ApplyCurCamInfo"==a[0]&&(b+=a[0]+":",b+=_local_replaceColon(ApplyCurCamInfo(a[1])),b+=":"+a[2]);"function"==typeof MsgBuilder&&MsgBuilder(b)}function dom3dReszie(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].reszieScene()}window.addEventListener("resize",dom3dReszie,!1);window.addEventListener("load",dom3dReszie,!1);function animateGlobal(){for(var a in scene3D)scene3D[a].actived&&scene3D[a].animate()}function create3dScene(a,b){var c=scene3D[a];null==c?(c=new EmpScene,c.initScene(a),scene3D[a]=c,b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls),"undefined"!==typeof b.jsonfile&&c.loadEmpObjs(b.jsonfile,"","",{},b.fileLoadEndFunc,b.progressFuncs))):b&&("undefined"!==typeof b.size&&c.setSceneSize(b.size[0],b.size[1]),c.setClearColor(b.bgcolor,b.bgalpha),"undefined"!==typeof b.controls&&c.setControlType(b.controls),"undefined"!==typeof b.jsonfile&&c.loadEmpObjs(b.jsonfile,"","",{},b.fileLoadEndFunc));return c}EmpSceneItemLoad.prototype.empSkeleton=function(a,b,c,e){if("undefined"!=typeof a.geometry){a.geometry.computeBoundingBox();for(e=0;e<a.materials.length;e++){var d=a.materials[e];d.skinning=!0;d.morphTargets=!0}a=new THREE.SkinnedMesh(a.geometry,new THREE.MultiMaterial(a.materials));"undefined"!==typeof b.name?a.name=b.name:"undefined"!==typeof b.meshName&&(a.name=b.meshName);a.visible=b.visible;a.uuid=c;c=new THREE.Matrix4;c.set(b.mat_wts[0],b.mat_wts[1],b.mat_wts[2],b.mat_wts[3],b.mat_wts[4],b.mat_wts[5],b.mat_wts[6],b.mat_wts[7],b.mat_wts[8],b.mat_wts[9],b.mat_wts[10],b.mat_wts[11],b.mat_wts[12],b.mat_wts[13],b.mat_wts[14],b.mat_wts[15]);a.applyMatrix(c);a.updateMatrixWorld(!0);return a}};EmpSceneItemLoad.prototype.skeleton=EmpSceneItemLoad.prototype.empSkeleton;EmpSceneItemLoad.prototype.DirectionalLight=function(a,b,c){var e=new THREE.Color,d=c.findObjectByUUID(b);d?(d.color.set(e.fromArray(a.LightColor).getHex()),d.intensity=a.IntenSity,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,d.updateMatrix(),d.updateMatrixWorld(!0)):(d=new THREE.DirectionalLight(e.fromArray(a.LightColor).getHex(),a.IntenSity),d.uuid=b,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,c.addObject(d)&&1==empSizeObj.builderMode&&(a=new THREE.DirectionalLightHelper(d,100),a.uuid=b,a.name="EMPLIGHT",c.lightHelper[b]=a,c.showGridFlag?c.sceneHelpers.add(a):null));return d};EmpSceneItemLoad.prototype.HemisphereLight=function(a,b,c){var e=new THREE.Color,d=c.findObjectByUUID(b);d?(d.color.set(e.fromArray(a.LightColor).getHex()),d.groundColor.set(e.fromArray(a.GroundColor).getHex()),d.intensity=a.IntenSity,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,d.updateMatrix(),d.updateMatrixWorld(!0)):(d=new THREE.HemisphereLight(e.fromArray(a.LightColor).getHex(),e.fromArray(a.GroundColor).getHex(),a.IntenSity),d.uuid=b,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,c.addObject(d)&&1==empSizeObj.builderMode&&(a=new THREE.HemisphereLightHelper(d),a.uuid=b,a.name="EMPLIGHT",c.lightHelper[b]=a,c.showGridFlag?c.sceneHelpers.add(a):null));return d};EmpSceneItemLoad.prototype.SpotLight=function(a,b,c){var e=new THREE.Color,d=c.findObjectByUUID(b);d?(d.distance=a.Distance,d.angle=a.Angle,d.Exponent=a.Exponent,d.color.set(e.fromArray(a.LightColor).getHex()),d.intensity=a.IntenSity,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,d.updateMatrix(),d.updateMatrixWorld(!0)):(d=new THREE.SpotLight(e.fromArray(a.LightColor).getHex(),a.IntenSity,a.Distance,a.Angle,a.Exponent),d.uuid=b,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,c.addObject(d)&&1==empSizeObj.builderMode&&(a=new THREE.SpotLightHelper(d),a.uuid=b,a.name="EMPLIGHT",c.lightHelper[b]=a,c.showGridFlag?c.sceneHelpers.add(a):null));return d};EmpSceneItemLoad.prototype.AmbientLight=function(a,b,c){var e=new THREE.Color,d=c.findObjectByUUID(b);d?(d.color.set(e.fromArray(a.LightColor).getHex()),d.name=a.name,d.visible=a.visible):(d=new THREE.AmbientLight(e.fromArray(a.LightColor).getHex()),d.uuid=b,d.name=a.name,d.visible=a.visible,c.addObject(d));return d};EmpSceneItemLoad.prototype.PointLight=function(a,b,c){var e=new THREE.Color,d=c.findObjectByUUID(b);d?(d.distance=a.Distance,d.decay=a.Decay,d.color.set(e.fromArray(a.LightColor).getHex()),d.intensity=a.IntenSity,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,d.updateMatrix(),d.updateMatrixWorld(!0)):(d=new THREE.PointLight(e.fromArray(a.LightColor).getHex(),a.IntenSity,a.Distance,a.Decay),d.uuid=b,d.position.set(a.Position[0],a.Position[1],a.Position[2]),d.name=a.name,d.visible=a.visible,c.addObject(d)&&1==empSizeObj.builderMode&&(a=new THREE.PointLightHelper(d),a.uuid=b,a.name="EMPLIGHT",c.lightHelper[b]=a,c.showGridFlag?c.sceneHelpers.add(a):null));return d};